<h2>📅 Course Calendar & Batches</h2>

<!-- Search & Create -->
<section class="panel">
  <input [(ngModel)]="searchId" placeholder="Batch ID"/>
  <button (click)="onSearch()">Search Batch</button>
  <button (click)="toggleCreateForm()">➕ Create Batch</button>
</section>

<!-- Create/Edit Batch Form -->
<section *ngIf="showCreateForm" class="panel">
  <form [formGroup]="batchForm" (ngSubmit)="submitBatch()">
    <label>
      Calendar:
      <select formControlName="calendarId">
        <option *ngFor="let c of calendars" [value]="c.calendarId">
          {{c.course?.courseName}} ({{c.startDate | date}} - {{c.endDate | date}})
        </option>
      </select>
    </label>
    <label>
      Batch Name:
      <input type="text" formControlName="batchName"/>
    </label>
    <button type="submit" [disabled]="batchForm.invalid">
      {{ editingBatchId ? 'Update Batch' : 'Create Batch' }}
    </button>
    <button type="button" (click)="toggleCreateForm()">Cancel</button>
  </form>
</section>

<!-- Active Batches -->
<section class="panel">
  <h3>Active Batches</h3>
  <table *ngIf="activeBatches.length; else noActive">
    <thead>
      <tr>
        <th>Batch</th>
        <th>Course</th>
        <th>Start</th>
        <th>End</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let b of activeBatches">
        <td>{{b.batchName}}</td>
        <td>{{b.calendar?.course?.courseName}}</td>
        <td>{{b.calendar?.startDate | date}}</td>
        <td>{{b.calendar?.endDate | date}}</td>
        <td>
          <button (click)="toggleCreateForm(b)">✏️ Edit</button>
          <button (click)="deleteBatch(b.batchId)">🗑️</button>
        </td>
      </tr>
    </tbody>
  </table>
  <ng-template #noActive><em>No active batches</em></ng-template>
</section>
